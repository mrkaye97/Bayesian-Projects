"0","# Use expand.grid() to get all combos of age, sex, and treatment"
"0","cf.data <- expand.grid("
"0","  age = 23:74,"
"0","  sex = c(0, 1),"
"0","  treat = c(0, 1)"
"0",")"
"0","# compute probabilities from posterior draws"
"0","# notice that link() automatically back-transforms"
"0","# from the log odds to the probability scale"
"0","m.link <- link(m.arthritis , data = cf.data, refresh = 0)"
"0","# compute predicted heights for individuals"
"0","# sim() will return 0s and 1s"
"0","arthritis.sim <- sim(m.arthritis , data = cf.data, refresh = 0)"
"0","# add mean and upper/lower bounds for plotting"
"0","arthritis_plot_df <- cf.data %>%"
"0","  mutate("
"0","    prob = apply(m.link, 2, mean),"
"0","    prob.lo = apply(m.link, 2, PI, prob=0.97)[1,],"
"0","    prob.hi = apply(m.link, 2, PI, prob=0.97)[2,],"
"0","    sex = factor(sex, labels = c(""Female"", ""Male"")),"
"0","    treat = factor(treat, labels = c(""Placebo"", ""Treated""))"
"0","  )"
"0","# Now plot the results"
"0","cf.plot <- ggplot(data = arthritis_plot_df) +"
"0","  geom_jitter(data = arthritis, aes(x = Age, y = Better, color = Sex), width = 0, height = .02, alpha = 0.4) +"
"0","  geom_line(aes(x = age, y = prob, color = sex)) +"
"0","  geom_ribbon(aes(x = age, ymin = prob.lo, ymax = prob.hi, fill = sex), alpha = 0.3) +"
"0","  facet_wrap(~treat) +"
"0","  labs(y = ""Pr(Better)"") +"
"0","  scale_fill_viridis_d(""Sex"") +"
"0","  scale_color_viridis_d() +"
"0","  theme(legend.position = ""top"")"
"0","cf.plot"
